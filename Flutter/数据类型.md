# Dart 数据类型详解

Dart 是一种强类型语言，具有静态类型检查和类型推断特性。本文档详细介绍 Dart 中的各种数据类型。

## 基本数据类型

### Number（数字）
Dart 提供两种数字类型：`int` 和 `double`。

```dart
// 整数类型 (int)
int age = 30;
int hexValue = 0xFFFF; // 十六进制表示

// 浮点数类型 (double)
double pi = 3.14159;
double e = 2.71828;

// 数字操作
int sum = 10 + 20;
double average = (95.5 + 87.0) / 2;
```

### String（字符串）
Dart 字符串是 UTF-16 编码的字符序列，可以使用单引号或双引号定义。

```dart
// 字符串定义
String name = 'John';
String message = "Hello, World!";

// 多行字符串
String paragraph = '''This is a
multi-line
string.''';

// 字符串插值
String greeting = "Hello, $name!";
String info = "You are ${age} years old.";

// 字符串连接
String combined = 'Hello ' + name;
```

### Booleans（布尔值）
Dart 布尔类型只有两个值：`true` 和 `false`。

```dart
// 布尔值定义
bool isActive = true;
bool isCompleted = false;

// 布尔表达式
bool isAdult = age >= 18;
```

### Functions（函数）
函数是 Dart 中的一等公民，可以作为变量、参数和返回值使用。

```dart
// 定义函数
int add(int a, int b) {
  return a + b;
}

// 作为变量
var multiply = (int a, int b) => a * b;
print(multiply(5, 3)); // 输出: 15

// 作为参数
void applyOperation(int a, int b, int Function(int, int) operation) {
  print(operation(a, b));
}
applyOperation(10, 5, add); // 输出: 15

// 作为返回值
Function makeAdder(int addBy) {
  return (int number) => number + addBy;
}
var addFive = makeAdder(5);
print(addFive(10)); // 输出: 15
```

### List（列表）
列表是有序的对象集合，类似于其他语言中的数组。

```dart
// 创建列表
List<int> numbers = [1, 2, 3, 4, 5];
List<String> fruits = ['Apple', 'Banana', 'Orange'];

// 可变列表
List<int> mutableList = [1, 2, 3];
mutableList.add(4); // 添加元素
mutableList[0] = 10; // 修改元素

// 不可变列表
List<int> immutableList = const [1, 2, 3];

// 列表操作
int first = numbers.first;
int last = numbers.last;
List<int> evenNumbers = numbers.where((n) => n % 2 == 0).toList();
```

### Sets（集合）
集合是无序的唯一对象集合。

```dart
// 创建集合
Set<String> uniqueNames = {'Alice', 'Bob', 'Charlie'};

// 添加元素
uniqueNames.add('David');
uniqueNames.add('Alice'); // 重复元素不会被添加

// 检查元素是否存在
bool containsAlice = uniqueNames.contains('Alice');

// 集合操作
Set<String> moreNames = {'Eve', 'Frank', 'Alice'};
Set<String> union = uniqueNames.union(moreNames); // 合并两个集合，去重
Set<String> intersection = uniqueNames.intersection(moreNames); // 两个集合的交集
```

### Maps（映射）
映射是键值对的集合，类似于其他语言中的字典或哈希表。

```dart
// 创建映射
Map<String, int> ages = {'Alice': 25, 'Bob': 30, 'Charlie': 35};

// 添加或修改键值对，不能使用 ages.Bob 来访问
ages['David'] = 40;
ages['Alice'] = 26; 

// 获取值
int? aliceAge = ages['Alice'];
int unknownAge = ages['Unknown'] ?? 0; // 使用默认值

// 遍历映射
ages.forEach((key, value) {
  print('$key: $value');
});

// 获取键、值
ages.keys // 所有键：(Alice, Bob, Charlie)
ages.values // 所有值：(26, 30, 35)

/**
 * 相等性：默认比较引用相等性
 */ 
// 示例 1：两个变量指向同一个 Map 实例
Map<String, int> map1 = {'Alice': 25, 'Bob': 30};
Map<String, int> map2 = map1; // map2 引用 map1 指向的同一个对象

print(map1 == map2); // true，因为它们引用同一个对象
map2['Alice'] = 26; // 修改 map2 也会影响 map1，因为它们是同一个对象
print(map1['Alice']); // 输出: 26

// 示例 2：两个内容相同但不同实例的 Map
Map<String, int> map3 = {'Alice': 25, 'Bob': 30};
Map<String, int> map4 = {'Alice': 25, 'Bob': 30}; // 创建了一个新的 Map 实例

print(map3 == map4); // false，因为它们引用不同的对象，尽管内容相同
map4['Alice'] = 26; // 修改 map4 不会影响 map3，因为它们是不同的对象
print(map3['Alice']); // 输出: 25
print(map4['Alice']); // 输出: 26
```

### Records（记录）
Records 是一种不可变的数据结构，用于存储固定数量的、可能不同类型的值，类似于元组（Tuple），但具有命名字段能力。

```dart
// 定义一个记录
var record = (name: 'Alice', age: 25, isActive: true);

// 访问记录字段
print(record.name); // 输出: Alice
print(record.age); // 输出: 25

// 类型化记录
(String, int, bool) userRecord = ('Bob', 30, false);

// 访问无名字段
print(userRecord.$1); // 输出: Bob
print(userRecord.$2); // 输出: 30

// 解构记录
var (firstName, userAge, activeStatus) = userRecord;
print(firstName); // 输出: Bob

// 相等性：比较结构相等性，当且仅当所有对应字段的值都相等时，两个记录才相等。
var record1 = (name: 'Alice', age: 25);
var record2 = (name: 'Alice', age: 25);
print(record1 == record2); // true，结构相等
```

### Runes（符文）
Runes 表示 Unicode 字符的 UTF-32 编码点。在字符串中，Unicode 字符可以使用 `\u{码点}` 表示。

```dart
// 使用 Runes 表示特殊字符
String smiley = '\u{1F600}'; // 😀
String heart = '\u{2764}'; // ❤️

// 获取字符串的 runes
Runes runes = smiley.runes;

// 遍历 runes
for (var rune in runes) {
  print(rune); // 输出 Unicode 码点
  print(String.fromCharCode(rune)); // 输出对应的字符
}
```

### Symbols（符号）
Symbol 表示 Dart 程序中的标识符，通常用于反射。

```dart
// 创建符号
Symbol symbol1 = Symbol('myVariable');
Symbol symbol2 = #anotherVariable; // 简写语法

// 符号比较
bool isEqual = symbol1 == Symbol('myVariable'); // true

// 在反射中使用（需要 import 'dart:mirrors'）
// 注意：Flutter 不支持 dart:mirrors 库
```

## 特殊类型

### 1. Null
`Null` 类型只有一个值 `null`，表示空值。在空安全模式下，默认情况下变量不能为 null。

```dart
// 可空类型
String? nullableName;
nullableName = null; // 合法

// 非空类型
String nonNullableName = 'Alice';
nonNullableName = null; // 编译错误

// 空值检查
String name = nullableName ?? 'Unknown';
String anotherName = nullableName!; // 断言不为空，为空则抛出异常
```

### 2. dynamic
`dynamic` 类型允许变量存储任何类型的值，关闭类型检查。

```dart
dynamic value = 42;
value = 'Hello'; // 合法
value = true; // 合法
```

### 3. var
`var` 声明变量时，Dart 会根据初始值推断其类型。

```dart
var count = 42; // 推断为 int 类型
var name = 'Alice'; // 推断为 String 类型
var list = [1, 2, 3]; // 推断为 List<int> 类型
```

### 4. Object
`Object` 是所有 Dart 对象的基类。

```dart
Object num = 42;
Object str = 'Hello';
```

### 5. void
`void` 表示没有返回值的函数。

```dart
void printMessage(String message) {
  print(message);
}
```

### 6. Never
`Never` 表示永远不会返回的函数，通常用于抛出异常或无限循环的函数。

```dart
Never throwError() {
  throw Exception('An error occurred');
}
```

## 类型系统特性

### 1. 静态类型
Dart 是静态类型语言，变量的类型在编译时确定。

```dart
String name = 'Alice'; // 明确指定类型
name = 42; // 编译错误，类型不匹配
```

### 2. 类型推断
Dart 可以根据上下文推断变量类型，无需显式声明。

```dart
var age = 30; // 推断为 int 类型
double area = 3.14 * 5 * 5; // 推断表达式结果为 double 类型
```

### 3. 空安全
Dart 2.12 引入了空安全特性，默认情况下变量不能为 null。

```dart
// 可空类型声明
int? nullableInt;
String? nullableString = null;

// 空值判断操作符
String name = nullableString ?? 'Default';
print(nullableString?.length); // 如果为 null 则返回 null，不会抛出异常
```

## 类型转换

### 1. 隐式转换
Dart 不会自动进行某些类型转换，需要显式转换。

```dart
// 以下代码会导致编译错误
int i = 42;
double d = i; // 错误
```

### 2. 显式转换

```dart
// 数字类型转换
int i = 42;
double d = i.toDouble();

// 字符串转换
String intStr = i.toString();
String doubleStr = d.toStringAsFixed(2); // 保留2位小数

// 解析字符串为数字
int parsedInt = int.parse('42');
double parsedDouble = double.parse('3.14');

// 布尔值转换
String boolStr = true.toString();
```

## 类型检查和转换操作符

### 1. is 操作符
检查对象是否为指定类型。

```dart
void checkType(dynamic value) {
  if (value is int) {
    print('Value is an integer');
  } else if (value is String) {
    print('Value is a string');
  }
}
```

### 2. is!
检查对象是否不是指定类型。

```dart
if (value is! int) {
  print('Value is not an integer');
}
```

### 3. as 操作符
将对象转换为指定类型。

```dart
dynamic value = 'Hello';
String str = value as String;
```

## 类型别名
类型别名允许为现有类型创建新名称，提高代码可读性。

```dart
// 为函数类型创建别名
typedef IntOperation = int Function(int, int);

// 使用别名
IntOperation add = (a, b) => a + b;
IntOperation multiply = (a, b) => a * b;

// 为复杂类型创建别名
typedef UserMap = Map<String, Map<String, dynamic>>;

// 使用别名
UserMap users = {
  'user1': {'name': 'Alice', 'age': 25},
  'user2': {'name': 'Bob', 'age': 30}
};
```