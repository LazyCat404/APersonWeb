# Flutter 基础常识

> `Flutter` 是 **Google** 开发的一款以`Dart`语言为基础的开源 *UI 框架*，用于构建**跨平台**的高性能移动应用、Web 应用和桌面应用。

## 开发环境

> 请参考 [Flutter 官方文档](https://docs.flutter.cn/) 安装 `Flutter` 开发环境。

- `FLUTTER_STORAGE_BASE_URL`：`https://storage.flutter-io.cn`

- `PUB_HOSTED_URL：https`：`https://pub.flutter-io.cn`

## 构建 Flutter 项目

> 确保已安装 `Flutter` 开发环境，正确配置环境变量

### 1. 环境检测

> 构建不同平台的 Flutter 项目需要不同的集成开发环境，如 `Android Studio` 或 `Chrome` 浏览器等。

```bash
flutter doctor
```
### 2. 创建 Flutter 项目

```bash
# 创建一个新的 Flutter 项目
flutter create my_app

# 指定平台
flutter create --platforms=web my_app

# 创建一个新的 Flutter 项目，包含 Android 和 iOS 平台， 末尾的 . 表示在当前目录创建项目
flutter create --platforms=android,ios .
```
### 3. 依赖安装

```bash
# 添加项目依赖
flutter pub add <package>

# 移除项目依赖
flutter pub remove <package>

# 安装项目（重新安装）依赖
flutter pub get
```
### 4. 运行 Flutter 项目

```bash
# 运行 Flutter 项目
flutter run
```

### 5. 构建 Flutter 项目

```bash
# 构建 Flutter 项目
flutter build <platform>
```

## 核心特点

- 跨平台一致性：一份代码可运行在 **iOS**、**Android**、**Web**、**Windows**、**macOS**、**Linux** 等平台

- 高性能渲染：使用 **Skia 图形引擎**直接绘制 UI，性能接近原生应用

- 热重载：开发过程中修改代码可实时预览效果，大幅提升开发效率

- 丰富的组件库：提供 **Material Design** 和 **Cupertino** 风格的组件，满足不同平台设计需求

## 技术栈

- 开发语言：`Dart`

- 渲染引擎：`Skia`

- 架构模式：声明式 UI

## Widget 系统

> 在 `Flutter` 中，万物皆是 `Widget`，`Widget` 是构建 UI 的基本单位。

### 无状态（Stateless）组件

> 在其生命周期内不发生变化。

```dart
class MyApp extends StatelessWidget {
  
  const MyApp({super.key});

  @override
  Widget build(BuildContext context) {
   return MaterialApp(
      home: Scaffold(
        body: Center(
          child: Text(
            'Hello World！',
            style: TextStyle(fontSize: 24, fontWeight: FontWeight.bold),
          ),
        ),
      ),
    );
  }
}
```

### 有状态（Stateful）组件

> 在其生命周期内，UI 会根据状态变化而更新，通过 `setState()` 更新状态

```dart
class MyApp extends StatefulWidget {
  const MyApp({super.key});

  @override
  State<MyApp> createState() => _MyApp();
}

class _MyApp extends State<MyApp> {

  @override
  Widget build(BuildContext context) {
    return const MaterialApp(
      home: Scaffold(
        body: Center(
          child: Text(
            'Hello World！',
            style: TextStyle(fontSize: 24, fontWeight: FontWeight.bold),
          ),
        ),
      ),
    );
  }
}
```

### 生命周期

| 方法 | 无状态组件 | 有状态组件 | 调用时机 | 作用 | 注意事项 |
|------|-------------------------------|-------------------------------|----------|------|----------|
| **构造函数** | ✅ 支持 | ✅ 支持 | 组件创建时 | 初始化组件实例，接收参数 | 仅用于接收参数，不适合初始化操作 |
| **`createState()`** | ❌ 不支持 | ✅ 支持 | 构造函数后 | 创建 `State` 对象 | 每个组件实例调用一次，返回新的 `State` 实例 |
| **`initState()`** | ❌ 不支持 | ✅ 支持 | `State` 创建后 | 初始化 `State`，如订阅、初始化数据 | 仅调用一次，适合执行一次性**初始化**操作 |
| **`didChangeDependencies()`** | ❌ 不支持 | ✅ 支持 | `initState()` 后<br>依赖的 `InheritedWidget` 变化时 | 处理依赖变化 | 可能多次调用，需注意重复执行的逻辑 |
| **`didUpdateWidget()`** | ❌ 不支持 | ✅ 支持 | 父组件重建且传递了新的 `Widget` 实例时 | 处理 Widget 实例更新 | 可用于比较新旧 Widget 的参数差异 |
| **`build()`** | ✅ 支持 | ✅ 支持 | 首次创建后<br>父组件更新后<br>依赖变化后 | 构建 UI 树 | 应是纯函数，避免耗时操作 |
| **`dispose()`** | ❌ 不支持 | ✅ 支持 | 组件从树中移除时 | 清理资源，如取消订阅、关闭流 | 仅调用一次，必须清理所有占用的资源 |

```dart
// StatefulWidget 类（不可变）
class MyApp extends StatefulWidget {
  const MyApp({super.key});

  // 只有 createState() 方法在这里
  @override
  State<MyApp> createState() => _MyApp();
}

// State 类（可变，管理生命周期）
class _Name extends State<MyApp> {
  // 所有生命周期方法都在这里
  @override
  void initState() { /* ... */ }

  @override
  void didChangeDependencies() { /* ... */ }

  @override
  void didUpdateWidget(covariant MyApp oldWidget) { /* ... */ }

  @override
  Widget build(BuildContext context) { /* ... */ }

  @override
  void dispose() { /* ... */ }
}
```

## 组件通信

### 父 -> 子

### 子 -> 父

## 官方组件库

### [Material 组件库](https://m3.material.io/)

> 提供符合 Material Design 规范的组件。

### Cupertino 组件库

> 提供符合 iOS 设计规范的组件。